<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Archive Resource Viewer</title>
    <link rel="icon" type="image/x-icon"
    href="favicon.ico"/>
    <meta name="og:title" content="Blue Archive Spine Viewer"/>
	<meta property="og:url" content="https://respectz.github.io/blue-archive-spine/" />
	<meta name="keywords" content="bluearchive"/>
	<meta name="description" content="Blue Archive Spine Viewer"/>
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- PIXI -->
    <script src="js/pixi.js"></script>
    <script src="js/pixi-spine.js"></script>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.9.2/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.2/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.9.2/dist/js/uikit-icons.min.js"></script>

    <!-- Main -->
    <script src="js/main.js"></script>

    <!-- Utility -->
    <script src="js/utility.js"></script>

    <!-- Howler -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js" integrity="sha512-6+YN/9o9BWrk6wSfGxQGpt3EUK6XeHi6yeHV+TYD2GR0Sj/cggRpXr1BrAQf0as6XslxomMUxXp2vIl+fv0QRA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <nav class="uk-navbar-container" uk-navbar style="position: fixed;background: none;">
        <div class="uk-navbar-left">
    
            <ul class="uk-navbar-nav">
                <li class="uk-active">
                    <button class="uk-button uk-button-default" type="button" uk-toggle="target: #sidebar-options"><span uk-icon="cog"></span></button>
                </li>
            </ul>
    
        </div>
    </nav>
    

    <div id="sidebar-options" uk-offcanvas>
        <div class="uk-offcanvas-bar">

            <button class="uk-offcanvas-close" type="button" uk-close></button>
            <h3>Blue Archive Spines</h3>
            <p>Select Model</p>
            <select class="uk-select" id="optionModels">
            </select>
            <p>Select Animation</p>
            <select class="uk-select" id="optionAnimations">
            </select>
            <p><label><input class="uk-checkbox" type="checkbox" id="optionLoop"> Loop</label></p>
            <p><label><input class="uk-checkbox" type="checkbox" id="optionTalkSound"> Play Talk Sound</label></p>
            <ul uk-accordion>
                <li>
                    <a class="uk-accordion-title" href="#">Advanced Options</a>
                    <div class="uk-accordion-content">
                        <div class="uk-grid-small" uk-grid>
                            <div class="uk-width-1-1">
                                <button class="uk-button uk-button-default" id="optionScaleFit">Fit Scale</button>
                                <button class="uk-button uk-button-default" id="optionScaleHalf">1/2 Scale</button>
                            </div>
                            <div class="uk-width-1-4 uk-margin">
                                <p>Scale</p>
                            </div>
                            <div class="uk-width-3-4">
                                <input class="uk-input" type="number" min="0.01" step="0.01" id="optionScale">
                            </div>
                            <div class="uk-width-1-1">
                                <p><label><input class="uk-checkbox" type="checkbox" id="optionAutoPos" checked> Auto Centerize</label></p>
                            </div>
                            <div class="uk-width-1-4 uk-margin">
                                <p>X</p>
                            </div>
                            <div class="uk-width-3-4">
                                <input class="uk-input" type="number" min="0" step="1" id="optionX" disabled>
                            </div>
                            <div class="uk-width-1-4 uk-margin">
                                <p>Y</p>
                            </div>
                            <div class="uk-width-3-4">
                                <input class="uk-input" type="number" min="0" step="1" id="optionY" disabled>
                            </div>
                        </form>
                    </div>
                </li>
            </ul>
            

        </div>
    </div>

    <canvas id="screen"></canvas>
    <!-- load it -->
    <script>
        let option = {
            models: document.getElementById("optionModels"),
            animations: document.getElementById("optionAnimations"),
            loop: document.getElementById("optionLoop"),
            talkSound: document.getElementById("optionTalkSound"),
            scaleFit: document.getElementById("optionScaleFit"),
            scaleHalf: document.getElementById("optionScaleHalf"),
            scale: document.getElementById("optionScale"),
            autoPos: document.getElementById("optionAutoPos"),
            x: document.getElementById("optionX"),
            y: document.getElementById("optionY")
        }

        // Init models
        let dataModels = JSON.parse(httpGet("./data/models.json"))
        for(var i in dataModels) {
            let opt = document.createElement("option");
            opt.value = `${i}/${dataModels[i]}`;
            opt.innerHTML = dataModels[i].substr(0, dataModels[i].length - 5);
            option.models.appendChild(opt);
        }

        // Events
        option.models.onchange = function() {
            localStorage.setItem("blue-archive-res-model", this.value);
            loadChar(this.value)
        }
        option.animations.onchange = function() {
            option.talkSound.checked ? playAnimation(this.value) : char.state.setAnimation(0, this.value, option.loop.checked);
        }
        option.loop.onchange = function() {
            localStorage.setItem("blue-archive-res-loop", this.checked);
            char.state.setAnimation(0, option.animations.value, this.checked);
        }
        option.talkSound.onchange = function() {
            localStorage.setItem("blue-archive-res-talkSound", this.checked);
        }
        option.scaleFit.onclick = function() {
            if(isCharacterLoaded)
                char.scale.x = char.scale.y = option.scale.value = option.models.value.indexOf("_home") != -1 ? Math.max(app.renderer.height/char.spineData.height, app.renderer.width/char.spineData.width) : Math.min(app.renderer.height/char.spineData.height, app.renderer.width/char.spineData.width);
        }
        option.scaleHalf.onclick = function() {
            if(isCharacterLoaded)
                char.scale.x = char.scale.y = option.scale.value = 0.5;
        }
        option.scale.onchange = function() {
            if(isCharacterLoaded)
                char.scale.x = char.scale.y = option.scale.value;
        }
        option.autoPos.onchange = function() {
            if(!isCharacterLoaded)
                return;
            if(this.checked) {
                option.x.disabled = option.y.disabled = true;
                option.x.value = char.x = app.screen.width/2;
                option.y.value = char.y = app.screen.height/1;
            } else {
                option.x.disabled = option.y.disabled = false;
            }
        }
        option.x.onchange = function() {
            char.x = this.value;
        }
        option.y.onchange = function() {
            char.y = this.value;
        }
        //Load localStorage if exists
        if(localStorage["blue-archive-res-model"])
            option.models.value = localStorage["blue-archive-res-model"]
        if(localStorage["blue-archive-res-loop"])
            option.loop.checked = localStorage["blue-archive-res-loop"]
        if(localStorage["blue-archive-res-talkSound"])
            option.talkSound.checked = localStorage["blue-archive-res-talkSound"]

        // Start
        reCanvas();
        loadChar(option.models.value);
        
    </script>
</body>
</html>
